<html>
  <head>
  </head>
  <script src="https://cdn.ethers.io/lib/ethers-5.6.umd.min.js" type="text/javascript"> </script>
  <script src="zepto.min.js" type="text/javascript"> </script>
  <script type="text/javascript">
    //Edit this \/
    const factory_addr="0x8b69036956f1f7d0E32B3f142D5D7b37A316825F";
    const factory_abi=[ { "inputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_tags", "outputs": [ { "internalType": "string", "name": "tag", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "components": [ { "internalType": "string", "name": "key", "type": "string" }, { "internalType": "string", "name": "value", "type": "string" } ], "internalType": "struct kv[]", "name": "props", "type": "tuple[]" }, { "internalType": "string[]", "name": "tags_", "type": "string[]" } ], "name": "create_attestation", "outputs": [ { "internalType": "contract Attestation", "name": "", "type": "address" } ], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "new_tag", "type": "string" } ], "name": "create_tag", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "init", "outputs": [ { "internalType": "contract Factory", "name": "", "type": "address" } ], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "tags", "outputs": [ { "components": [ { "internalType": "string", "name": "tag", "type": "string" }, { "internalType": "address[]", "name": "addresses", "type": "address[]" } ], "internalType": "struct tag[]", "name": "", "type": "tuple[]" } ], "stateMutability": "view", "type": "function" } ];
    const attestation_abi=[ { "inputs": [ { "internalType": "address", "name": "", "type": "address" }, { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_attestations_about", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "", "type": "address" }, { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_attestations_by", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_attestees", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_attestors", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_props", "outputs": [ { "internalType": "string", "name": "key", "type": "string" }, { "internalType": "string", "name": "value", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "_tags", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "about_addr", "type": "address" } ], "name": "attest", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "attestee", "type": "address" } ], "name": "attestations_about", "outputs": [ { "internalType": "address[]", "name": "", "type": "address[]" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "attestor", "type": "address" } ], "name": "attestations_by", "outputs": [ { "internalType": "address[]", "name": "", "type": "address[]" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "attestees", "outputs": [ { "internalType": "address[]", "name": "", "type": "address[]" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "attestors", "outputs": [ { "internalType": "address[]", "name": "", "type": "address[]" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "components": [ { "internalType": "string", "name": "key", "type": "string" }, { "internalType": "string", "name": "value", "type": "string" } ], "internalType": "struct kv[]", "name": "props_", "type": "tuple[]" }, { "internalType": "string[]", "name": "tags_", "type": "string[]" } ], "name": "init", "outputs": [ { "internalType": "contract Attestation", "name": "", "type": "address" } ], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "props", "outputs": [ { "components": [ { "internalType": "string", "name": "key", "type": "string" }, { "internalType": "string", "name": "value", "type": "string" } ], "internalType": "struct kv[]", "name": "", "type": "tuple[]" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "tags", "outputs": [ { "internalType": "string[]", "name": "", "type": "string[]" } ], "stateMutability": "view", "type": "function" } ];
    const zero_addr="0x0000000000000000000000000000000000000000";
    var provider, signer, factory_ro, factory_rw;
    //poor man's html factory
    ['h1','h2','h3','div','p','ul','li','button','a'].forEach((tag) => {
      window[tag]=(attrs, content="") => {
        return $('<'+tag+' />', attrs).append(content);
      }
    })

    Zepto(function($){
      $('button').on("click", function(e) {button_actions[e.target.id].call()})
    })
    const button_actions={
      "mm_connect": function() {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        factory_ro=new ethers.Contract(factory_addr, factory_abi, provider);
        factory_rw=new ethers.Contract(factory_addr, factory_abi, signer);
        $('#mm_connect').hide();
        get_tags().then((tags) => show_tags(tags));
      },
      "save_prop": function(e) {alert("asdf")}
    }

    function get_tags() {
    }
    function show_tags() {
    }
  </script>
  <body>
    <h1>Attestation Management</h1>
    <button id="mm_connect">Connect to wallet</button>
    <button id="new_attestation" onclick="show_attestation_form()">New Attestation</button>
    <h3>New Attestation</h3>
    <table id="attestation_props" border="1">
      <thead><th>Name</th><th>Value</th><th></th></thead>
        
      <tr id="prop_form"><td><input type="text" id="prop_key" value="Name" /></td><td><input type="text" id="prop_val" /></td><td><button id="save_prop">Save</button></td></tr>
    </table>
    <label for="tags">Tags:</label><input type="text" id="tags" name="tags" />
    <div id="tags"></div>
    <div id="attestations"></div>
  </body>
</html>
